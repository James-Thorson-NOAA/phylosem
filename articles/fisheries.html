<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Phylogenetic comparative methods in fisheries science • phylosem</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Phylogenetic comparative methods in fisheries science">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phylosem</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/comparison.html">Comparison with other packages</a></li>
    <li><a class="dropdown-item" href="../articles/demonstration.html">Demonstration of selected features</a></li>
    <li><a class="dropdown-item" href="../articles/fisheries.html">Phylogenetic comparative methods in fisheries science</a></li>
    <li><a class="dropdown-item" href="../articles/phylopath.html">Detailed comparison with `phylopath`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/James-Thorson-NOAA/phylosem/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Phylogenetic comparative methods in fisheries science</h1>
                        <h4 data-toc-skip class="author">James T.
Thorson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/James-Thorson-NOAA/phylosem/blob/main/vignettes/fisheries.Rmd" class="external-link"><code>vignettes/fisheries.Rmd</code></a></small>
      <div class="d-none name"><code>fisheries.Rmd</code></div>
    </div>

    
    
<p>Phylogenetic comparative methods (PCM) are rarely in fisheries
science, perhaps due to a lack of familiarity with methods and software
among fisheries scientists. This underuse is surprising, given that
fisheries science and management strongly depends on foundational
results from comparative methods regarding fish productivity and
life-history parameters, e.g., for defining proxies for biological
reference points and informing hard-to-estimate demographic rates such
as stock-recruit and natural mortality parameters.</p>
<div class="section level2">
<h2 id="preparing-the-then-et-al--mortality-database">Preparing the Then et al. mortality database<a class="anchor" aria-label="anchor" href="#preparing-the-then-et-al--mortality-database"></a>
</h2>
<p>To demonstrate the potential role for PCM in fisheries science, we
re-analyze a foundational dataset compiled by <a href="https://www.vims.edu/research/departments/fisheries/programs/mort_db/" class="external-link">Then
et al.</a>. We specifically download the file “Mlifehist_ver1.0.csv” and
then include a copy as a data object in package <em>phylosem</em> to
simplify the following demonstration. This demonstration then provides
basic syntax and output from PCM, showing the relationship between
natural mortality rate, longevity, and growth parameters.</p>
<p>To do so, we first load a phylogeny for fishes using package
<em>fishtree</em>, which includes several versions of a phylogeny for
fishes develoepd by <a href="https://doi.org/10.1038/s41586-018-0273-1" class="external-link">Rabosky et al.</a>. We
then associate all trait data with a tip label from that phylogeny, and
provide convenient names for the modeled variables.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://james-thorson-noaa.github.io/phylosem/">phylosem</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fishtreeoflife.org/" class="external-link">fishtree</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download tree</span></span>
<span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fishtree/man/fishtree_complete_phylogeny.html" class="external-link">fishtree_complete_phylogeny</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">=</span> <span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Load data object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">Mlifehist_ver1_0</span> <span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="va">Mlifehist_ver1_0</span></span>
<span></span>
<span><span class="co"># Reformat to match tree$tip.label</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Data</span><span class="op">$</span><span class="va">Genus</span>, <span class="st">"_"</span>, <span class="va">Data</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop duplicates ... not dealing with variation among stocks within species</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="va">Data</span><span class="op">[</span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/match.Splits.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span><span class="op">)</span>,<span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># log-transform to simplify later syuntax</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">Data</span>, <span class="st">"logM"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'M'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="st">"logK"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'K'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="st">"logtmax"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'tmax'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="st">"logLinf"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'Linf'</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify species in both datasets</span></span>
<span><span class="va">species_to_use</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span> <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>, <span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span> <span class="op">)</span></span>
<span><span class="va">species_to_drop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span> <span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span>, <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop tips not present in trait-data</span></span>
<span><span class="co"># Not strictly necessary, but helpful to simplify later plots</span></span>
<span><span class="va">tree</span> <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/drop.tip.html" class="external-link">keep.tip</a></span><span class="op">(</span> <span class="va">tree</span>, tip<span class="op">=</span><span class="va">species_to_use</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop trait-data not in phylogeny</span></span>
<span><span class="co"># Necessary to define correlation among data</span></span>
<span><span class="va">rows_to_use</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span> <span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">species_to_use</span> <span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="va">Data</span><span class="op">[</span><span class="va">rows_to_use</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Only include modeled variables in trait-data passed to phylosem</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span> <span class="op">=</span> <span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="va">Data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'logM'</span>,<span class="st">'logK'</span>,<span class="st">'logtmax'</span>,<span class="st">'logLinf'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-and-selecting-among-phylogenetic-structural-equation-models">Fitting and selecting among phylogenetic structural equation
models<a class="anchor" aria-label="anchor" href="#fitting-and-selecting-among-phylogenetic-structural-equation-models"></a>
</h2>
<p>We then define a path diagram specifying a set of linkages among
variables. In the following, we use a path diagram that ensures that
mortality rate is statistically independent of growth, conditional upon
a measurement for longevity. This specification ensures that, if
longevity is available, then it is the sole information used to predict
mortality rate. However, if longevity is not available, the model
reverts to predicting mortality from growth parameters.</p>
<p>We then fit this model using phylogenetic structural equation models.
We specifically apply a grid-search across the eight models formed by
any combination of modeled transformations of the phylogenetic tree. We
then use marginal AIC to select a model, and list estimated path
coefficients.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify SEM structure</span></span>
<span><span class="va">sem_structure</span> <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">  logK -&gt; logtmax, b1</span></span>
<span><span class="st">  logLinf -&gt; logtmax, b2</span></span>
<span><span class="st">  logtmax -&gt; logM, a</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="co"># Grid-search model selection using AIC for transformations</span></span>
<span><span class="va">Grid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span> <span class="st">"OU"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                    <span class="st">"lambda"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                    <span class="st">"kappa"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">psem_grid</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Grid</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">psem_grid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/phylosem.html">phylosem</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">Data</span>,</span>
<span>                   tree <span class="op">=</span> <span class="va">tree</span>,</span>
<span>                   sem <span class="op">=</span> <span class="va">sem_structure</span>,</span>
<span>                   estimate_ou <span class="op">=</span> <span class="va">Grid</span><span class="op">[</span><span class="va">i</span>,<span class="st">'OU'</span><span class="op">]</span>,</span>
<span>                   estimate_lambda <span class="op">=</span> <span class="va">Grid</span><span class="op">[</span><span class="va">i</span>,<span class="st">'lambda'</span><span class="op">]</span>,</span>
<span>                   estimate_kappa <span class="op">=</span> <span class="va">Grid</span><span class="op">[</span><span class="va">i</span>,<span class="st">'kappa'</span><span class="op">]</span>,</span>
<span>                   control <span class="op">=</span> <span class="fu"><a href="../reference/phylosem_control.html">phylosem_control</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Extract AIC for each model and rank-order by parsimony</span></span>
<span><span class="va">Grid</span><span class="op">$</span><span class="va">AIC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">psem_grid</span>, \<span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">Grid</span> <span class="op">=</span> <span class="va">Grid</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">Grid</span><span class="op">$</span><span class="va">AIC</span>,decreasing<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Select model with lowest AIC</span></span>
<span><span class="va">psem_best</span> <span class="op">=</span> <span class="va">psem_grid</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Grid</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">OU</th>
<th align="left">lambda</th>
<th align="left">kappa</th>
<th align="right">AIC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">1552.940</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">1553.164</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">1559.502</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">1561.424</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">1563.372</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">1643.863</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">1717.509</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">2358.137</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="28%">
<col width="25%">
<col width="12%">
<col width="10%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">Path</th>
<th align="left">VarName</th>
<th align="right">Estimate</th>
<th align="right">StdErr</th>
<th align="right">t.value</th>
<th align="right">p.value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">Intercept_logM</td>
<td align="right">1.668</td>
<td align="right">0.318</td>
<td align="right">5.250</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">Intercept_logK</td>
<td align="right">-1.759</td>
<td align="right">0.566</td>
<td align="right">3.107</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">Intercept_logtmax</td>
<td align="right">-0.575</td>
<td align="right">0.655</td>
<td align="right">0.878</td>
<td align="right">0.380</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">Intercept_logLinf</td>
<td align="right">6.559</td>
<td align="right">0.445</td>
<td align="right">14.742</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">logK -&gt; logtmax</td>
<td align="left">b1</td>
<td align="right">-0.448</td>
<td align="right">0.067</td>
<td align="right">6.716</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">logLinf -&gt; logtmax</td>
<td align="left">b2</td>
<td align="right">0.407</td>
<td align="right">0.086</td>
<td align="right">4.731</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">logtmax -&gt; logM</td>
<td align="left">a</td>
<td align="right">-1.022</td>
<td align="right">0.037</td>
<td align="right">27.732</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">logM &lt;-&gt; logM</td>
<td align="left">V[logM]</td>
<td align="right">0.056</td>
<td align="right">0.014</td>
<td align="right">3.966</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">logK &lt;-&gt; logK</td>
<td align="left">V[logK]</td>
<td align="right">0.105</td>
<td align="right">0.026</td>
<td align="right">4.047</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">logtmax &lt;-&gt; logtmax</td>
<td align="left">V[logtmax]</td>
<td align="right">0.078</td>
<td align="right">0.019</td>
<td align="right">4.029</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">logLinf &lt;-&gt; logLinf</td>
<td align="left">V[logLinf]</td>
<td align="right">0.082</td>
<td align="right">0.020</td>
<td align="right">4.122</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="visualizing-output">Visualizing output<a class="anchor" aria-label="anchor" href="#visualizing-output"></a>
</h2>
<p>Finally, we can convert output to formats from other packages, and
use existing and third-party PCM packages to plot, query, and
post-process output.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot path diagram</span></span>
<span><span class="va">my_fitted_DAG</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">psem_best</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_fitted_DAG</span>, type<span class="op">=</span><span class="st">"color"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fisheries_files/figure-html/unnamed-chunk-5-1.png" width="384"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Total, direct, and indirect effects</span></span>
<span><span class="va">my_sem</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sem.html">as_sem</a></span><span class="op">(</span><span class="va">psem_best</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/effects.html" class="external-link">effects</a></span><span class="op">(</span><span class="va">my_sem</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Total Effects (column on row)</span></span>
<span><span class="co">#&gt;               logK   logtmax    logLinf</span></span>
<span><span class="co">#&gt; logtmax -0.4480233  0.000000  0.4073488</span></span>
<span><span class="co">#&gt; logM     0.4579994 -1.022267 -0.4164192</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Direct Effects</span></span>
<span><span class="co">#&gt;               logK   logtmax   logLinf</span></span>
<span><span class="co">#&gt; logtmax -0.4480233  0.000000 0.4073488</span></span>
<span><span class="co">#&gt; logM     0.0000000 -1.022267 0.0000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Indirect Effects</span></span>
<span><span class="co">#&gt;              logK logtmax    logLinf</span></span>
<span><span class="co">#&gt; logtmax 0.0000000       0  0.0000000</span></span>
<span><span class="co">#&gt; logM    0.4579994       0 -0.4164192</span></span></code></pre></div>
<p>We also show how to plot output using phylosignal, although it is
currently unavailable on CRAN and therefore commented out:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load for plotting,</span></span>
<span><span class="co"># https://r-pkgs.org/vignettes.html#sec-vignettes-eval-option</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">phylosignal</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot using phylobase</span></span>
<span><span class="va">my_phylo4d</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_phylo4d.html">as_phylo4d</a></span><span class="op">(</span> <span class="va">psem_best</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">my_phylo4d</span><span class="op">)</span></span></code></pre></div>
<p><img src="fisheries_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="sensitivity-to-using-taxonomic-tree">Sensitivity to using taxonomic tree<a class="anchor" aria-label="anchor" href="#sensitivity-to-using-taxonomic-tree"></a>
</h2>
<p>After analysis, we can also conduct sensivity analyses. Here, we show
how to construct a taxonomic tree and use this in place of phylogenetic
information. As before, this requires some code to reformat the data and
then the statistical analysis is simple to specify. The estimated path
coefficients are very similar to estimates when using phyogeny.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="va">Mlifehist_ver1_0</span></span>
<span></span>
<span><span class="co"># Make taxonomic factors</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Data</span><span class="op">$</span><span class="va">Genus</span>, <span class="st">"_"</span>, <span class="va">Data</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Genus</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">Data</span><span class="op">$</span><span class="va">Genus</span> <span class="op">)</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Family</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">Data</span><span class="op">$</span><span class="va">Family</span> <span class="op">)</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Order</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">Data</span><span class="op">$</span><span class="va">Order</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Make taxonomic tree</span></span>
<span><span class="va">tree</span> <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html" class="external-link">as.phylo</a></span><span class="op">(</span> <span class="op">~</span><span class="va">Order</span><span class="op">/</span><span class="va">Family</span><span class="op">/</span><span class="va">Genus</span><span class="op">/</span><span class="va">Genus_species</span>, data<span class="op">=</span><span class="va">Data</span>, collapse<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">tree</span><span class="op">$</span><span class="va">edge.length</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">edge</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/collapse.singles.html" class="external-link">collapse.singles</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/root.html" class="external-link">root</a></span><span class="op">(</span><span class="va">tree</span>, node<span class="op">=</span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Ntip</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop duplicates ... not dealing with variation among stocks within species</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="va">Data</span><span class="op">[</span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/match.Splits.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span><span class="op">)</span>,<span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># log-transform to simplify later syuntax</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">Data</span>, <span class="st">"logM"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'M'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="st">"logK"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'K'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="st">"logtmax"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'tmax'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="st">"logLinf"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span>,<span class="st">'Linf'</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Only include modeled variables in trait-data passed to phylosem</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span> <span class="op">=</span> <span class="va">Data</span><span class="op">$</span><span class="va">Genus_species</span></span>
<span><span class="va">Data</span> <span class="op">=</span> <span class="va">Data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'logM'</span>,<span class="st">'logK'</span>,<span class="st">'logtmax'</span>,<span class="st">'logLinf'</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Fit model</span></span>
<span><span class="va">psem_taxon</span> <span class="op">=</span> <span class="fu"><a href="../reference/phylosem.html">phylosem</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">Data</span>,</span>
<span>                 tree <span class="op">=</span> <span class="va">tree</span>,</span>
<span>                 sem <span class="op">=</span> <span class="va">sem_structure</span>,</span>
<span>                 estimate_ou <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 control <span class="op">=</span> <span class="fu"><a href="../reference/phylosem_control.html">phylosem_control</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot path diagram</span></span>
<span><span class="va">my_fitted_DAG</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_fitted_DAG.html">as_fitted_DAG</a></span><span class="op">(</span><span class="va">psem_taxon</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_fitted_DAG</span>, type<span class="op">=</span><span class="st">"color"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fisheries_files/figure-html/unnamed-chunk-7-1.png" width="384"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
